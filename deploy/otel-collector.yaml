# SPDX-License-Identifier: Apache-2.0
apiVersion: v1
kind: ConfigMap
metadata: { name: otel-collector-config }
data:
  otel-collector-config.yaml: |
    receivers:
      otlp:
        protocols:
          http:
          grpc:
    exporters:
      logging: {}
    service:
      pipelines:
        traces: { receivers: [otlp], exporters: [logging] }
        metrics: { receivers: [otlp], exporters: [logging] }
        logs: { receivers: [otlp], exporters: [logging] }
---
apiVersion: apps/v1
kind: Deployment
metadata: { name: otel-collector }
spec:
  replicas: 1
  selector: { matchLabels: { app: otel-collector } }
  template:
    metadata: { labels: { app: otel-collector } }
    spec:
      containers:
      - name: otel-collector
        image: otel/opentelemetry-collector-contrib:latest
        args: ["--config=/etc/otel-collector-config.yaml"]
        volumeMounts:
          - name: cfg
            mountPath: /etc/otel-collector-config.yaml
            subPath: otel-collector-config.yaml
      volumes:
      - name: cfg
        configMap: { name: otel-collector-config }
